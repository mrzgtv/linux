Задание №1.
1. Подключить репозиторий с docker любым удобным способом, установить nginx используя утилиту apt потом удалить nginx, используя утилиту dpkg.

-----Подключение репозитория docker.-----

ilnaz@ubuntu-linux:~$ cat /etc/*release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=20.04
DISTRIB_CODENAME=focal
DISTRIB_DESCRIPTION="Ubuntu 20.04.1 LTS"
NAME="Ubuntu"
VERSION="20.04.1 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.1 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal

ilnaz@ubuntu-linux:~$ sudo apt-get update
Hit:1 http://ru.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://ru.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://ru.archive.ubuntu.com/ubuntu focal-backports InRelease [98,3 kB]  
Get:4 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Get:5 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [353 kB]
Get:6 http://ru.archive.ubuntu.com/ubuntu focal-updates/main i386 Packages [206 kB]
Get:7 http://ru.archive.ubuntu.com/ubuntu focal-updates/main Translation-en [133 kB]
Get:8 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 DEP-11 Metadata [209 kB]
Get:9 http://ru.archive.ubuntu.com/ubuntu focal-updates/main DEP-11 64x64 Icons [79,3 kB]
Get:10 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [8 968 B]
Get:11 http://ru.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [34,4 kB]
Get:12 http://ru.archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [8 944 B]
Get:13 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [165 kB]
Get:14 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe i386 Packages [90,5 kB]
Get:15 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [87,1 kB]
Get:16 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe amd64 DEP-11 Metadata [186 kB]
Get:17 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe DEP-11 48x48 Icons [93,4 kB]
Get:18 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe DEP-11 64x64 Icons [167 kB]
Get:19 http://ru.archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [5 424 B]
Get:20 http://ru.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 DEP-11 Metadata [2 468 B]
Get:21 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe i386 Packages [2 256 B]
Get:22 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [3 088 B]
Get:23 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe amd64 DEP-11 Metadata [1 768 B]
Get:24 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe DEP-11 48x48 Icons [2 809 B]
Get:25 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe DEP-11 64x64 Icons [3 944 B]
Get:26 http://ru.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Get:27 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [181 kB]
Get:28 http://security.ubuntu.com/ubuntu focal-security/main i386 Packages [69,9 kB]
Get:29 http://security.ubuntu.com/ubuntu focal-security/main Translation-en [64,5 kB]
Get:30 http://security.ubuntu.com/ubuntu focal-security/main amd64 DEP-11 Metadata [24,3 kB]
Get:31 http://security.ubuntu.com/ubuntu focal-security/main amd64 c-n-f Metadata [4 504 B]
Get:32 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [34,3 kB]
Get:33 http://security.ubuntu.com/ubuntu focal-security/restricted Translation-en [8 916 B]
Get:34 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [56,0 kB]
Get:35 http://security.ubuntu.com/ubuntu focal-security/universe i386 Packages [26,9 kB]
Get:36 http://security.ubuntu.com/ubuntu focal-security/universe Translation-en [29,4 kB]
Get:37 http://security.ubuntu.com/ubuntu focal-security/universe amd64 DEP-11 Metadata [52,3 kB]
Get:38 http://security.ubuntu.com/ubuntu focal-security/universe DEP-11 48x48 Icons [15,4 kB]
Get:39 http://security.ubuntu.com/ubuntu focal-security/universe DEP-11 64x64 Icons [22,5 kB]
Get:40 http://security.ubuntu.com/ubuntu focal-security/universe amd64 c-n-f Metadata [2 308 B]
Fetched 2 752 kB in 3s (978 kB/s)        
Reading package lists... Done

ilnaz@ubuntu-linux:~$ sudo apt-get install
Reading package lists... Done
Building dependency tree       
Reading state information... Done
0 upgraded, 0 newly installed, 0 to remove and 121 not upgraded.

ilnaz@ubuntu-linux:~$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
OK

ilnaz@ubuntu-linux:~$ sudo apt-key fingerprint 0EBFCD88
pub   rsa4096 2017-02-22 [SCEA]
      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid           [ unknown] Docker Release (CE deb) <docker@docker.com>
sub   rsa4096 2017-02-22 [S]

ilnaz@ubuntu-linux:~$ lsb_release -cs
focal

ilnaz@ubuntu-linux:~$ sudo add-apt-repository \
>    "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
>    $(lsb_release -cs) \
>    stable"

Hit:1 http://ru.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://ru.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://ru.archive.ubuntu.com/ubuntu focal-backports InRelease [98,3 kB]       
Hit:4 http://security.ubuntu.com/ubuntu focal-security InRelease                    
Get:5 https://download.docker.com/linux/ubuntu focal InRelease [36,2 kB]            
Get:6 https://download.docker.com/linux/ubuntu focal/stable amd64 Packages [3 056 B]
Fetched 249 kB in 1s (184 kB/s)
Reading package lists... Done

ilnaz@ubuntu-linux:~$ cat /etc/apt/sources.list
# deb cdrom:[Ubuntu 20.04.1 LTS _Focal Fossa_ - Release amd64 (20200731)]/ focal main restricted

# See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to
# newer versions of the distribution.
deb http://ru.archive.ubuntu.com/ubuntu/ focal main restricted
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal main restricted

## Major bug fix updates produced after the final release of the
## distribution.
deb http://ru.archive.ubuntu.com/ubuntu/ focal-updates main restricted
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal-updates main restricted

## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu
## team. Also, please note that software in universe WILL NOT receive any
## review or updates from the Ubuntu security team.
deb http://ru.archive.ubuntu.com/ubuntu/ focal universe
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal universe
deb http://ru.archive.ubuntu.com/ubuntu/ focal-updates universe
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal-updates universe

## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu 
## team, and may not be under a free licence. Please satisfy yourself as to 
## your rights to use the software. Also, please note that software in 
## multiverse WILL NOT receive any review or updates from the Ubuntu
## security team.
deb http://ru.archive.ubuntu.com/ubuntu/ focal multiverse
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal multiverse
deb http://ru.archive.ubuntu.com/ubuntu/ focal-updates multiverse
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal-updates multiverse

## N.B. software from this repository may not have been tested as
## extensively as that contained in the main release, although it includes
## newer versions of some applications which may provide useful features.
## Also, please note that software in backports WILL NOT receive any review
## or updates from the Ubuntu security team.
deb http://ru.archive.ubuntu.com/ubuntu/ focal-backports main restricted universe multiverse
# deb-src http://ru.archive.ubuntu.com/ubuntu/ focal-backports main restricted universe multiverse

## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu focal partner
# deb-src http://archive.canonical.com/ubuntu focal partner

deb http://security.ubuntu.com/ubuntu focal-security main restricted
# deb-src http://security.ubuntu.com/ubuntu focal-security main restricted
deb http://security.ubuntu.com/ubuntu focal-security universe
# deb-src http://security.ubuntu.com/ubuntu focal-security universe
deb http://security.ubuntu.com/ubuntu focal-security multiverse
# deb-src http://security.ubuntu.com/ubuntu focal-security multiverse

# This system was installed using small removable media
# (e.g. netinst, live or single CD). The matching "deb cdrom"
# entries were disabled at the end of the installation process.
# For information about how to configure apt package sources,
# see the sources.list(5) manual.
deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
# deb-src [arch=amd64] https://download.docker.com/linux/ubuntu focal stable


ilnaz@ubuntu-linux:~$ sudo apt update
Hit:1 http://ru.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://ru.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Get:4 http://ru.archive.ubuntu.com/ubuntu focal-backports InRelease [98,3 kB]
Hit:5 https://download.docker.com/linux/ubuntu focal InRelease                     
Fetched 317 kB in 1s (261 kB/s)
Reading package lists... Done
Building dependency tree       
Reading state information... Done
121 packages can be upgraded. Run 'apt list --upgradable' to see them.


----- Установка nginx с утилитой apt -----


ilnaz@ubuntu-linux:~$ sudo apt install nginx
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail
  libnginx-mod-stream nginx-common nginx-core
Suggested packages:
  fcgiwrap nginx-doc
The following NEW packages will be installed:
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail
  libnginx-mod-stream nginx nginx-common nginx-core
0 upgraded, 7 newly installed, 0 to remove and 121 not upgraded.
Need to get 602 kB of archives.
After this operation, 2 134 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-common all 1.18.0-0ubuntu1 [37,3 kB]
Get:2 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-image-filter amd64 1.18.0-0ubuntu1 [14,3 kB]
Get:3 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-xslt-filter amd64 1.18.0-0ubuntu1 [12,6 kB]
Get:4 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-mail amd64 1.18.0-0ubuntu1 [42,3 kB]
Get:5 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-stream amd64 1.18.0-0ubuntu1 [66,9 kB]
Get:6 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-core amd64 1.18.0-0ubuntu1 [425 kB]
Get:7 http://ru.archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx all 1.18.0-0ubuntu1 [3 624 B]
Fetched 602 kB in 1s (734 kB/s)
Preconfiguring packages ...
Selecting previously unselected package nginx-common.
(Reading database ... 155015 files and directories currently installed.)
Preparing to unpack .../0-nginx-common_1.18.0-0ubuntu1_all.deb ...
Unpacking nginx-common (1.18.0-0ubuntu1) ...
Selecting previously unselected package libnginx-mod-http-image-filter.
Preparing to unpack .../1-libnginx-mod-http-image-filter_1.18.0-0ubuntu1_amd64.deb ...
Unpacking libnginx-mod-http-image-filter (1.18.0-0ubuntu1) ...
Selecting previously unselected package libnginx-mod-http-xslt-filter.
Preparing to unpack .../2-libnginx-mod-http-xslt-filter_1.18.0-0ubuntu1_amd64.deb ...
Unpacking libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1) ...
Selecting previously unselected package libnginx-mod-mail.
Preparing to unpack .../3-libnginx-mod-mail_1.18.0-0ubuntu1_amd64.deb ...
Unpacking libnginx-mod-mail (1.18.0-0ubuntu1) ...
Selecting previously unselected package libnginx-mod-stream.
Preparing to unpack .../4-libnginx-mod-stream_1.18.0-0ubuntu1_amd64.deb ...
Unpacking libnginx-mod-stream (1.18.0-0ubuntu1) ...
Selecting previously unselected package nginx-core.
Preparing to unpack .../5-nginx-core_1.18.0-0ubuntu1_amd64.deb ...
Unpacking nginx-core (1.18.0-0ubuntu1) ...
Selecting previously unselected package nginx.
Preparing to unpack .../6-nginx_1.18.0-0ubuntu1_all.deb ...
Unpacking nginx (1.18.0-0ubuntu1) ...
Setting up nginx-common (1.18.0-0ubuntu1) ...
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.
Setting up libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1) ...
Setting up libnginx-mod-mail (1.18.0-0ubuntu1) ...
Setting up libnginx-mod-http-image-filter (1.18.0-0ubuntu1) ...
Setting up libnginx-mod-stream (1.18.0-0ubuntu1) ...
Setting up nginx-core (1.18.0-0ubuntu1) ...
Setting up nginx (1.18.0-0ubuntu1) ...
Processing triggers for systemd (245.4-4ubuntu3.2) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for ufw (0.36-6) ...
ilnaz@ubuntu-linux:~$ 


----- Удаление nginx с помощью dpkg -----

ilnaz@ubuntu-linux:~$ dpkg -r nginx
dpkg: error: requested operation requires superuser privilege
ilnaz@ubuntu-linux:~$ sudo dpkg -r nginx
(Reading database ... 155093 files and directories currently installed.)
Removing nginx (1.18.0-0ubuntu1) ...
ilnaz@ubuntu-linux:~$





2. Установить nginx. Создать два виртуальных хоста, причем оба из них работают на порту 80. На http запрос утилиты curl при указанном хедере Host: host1, должен приходить ответ с текстом This is host 1 со статусом 200. При указании хедера Host: host2 - ответ с текстом This is host 2 со статусом 200.



ilnaz@ubuntu-linux:~$ sudo apt install nginx

На моей ВМ файл default лежит в директории /etc/nginx/sites-enabled а не в /etc/nginx/conf.d как у Вас (директория /etc/nginx/conf.d у меня вообще пустая). Поэтому кончики для host1 и host2 были созданы в директории /etc/nginx/sites-enabled.


1. в директории /etc/nginx/sites-enabled создаем 2 файла: sudo touch host1 и sudo touch host2. 
В каждом файле соответственно прописываем следующие настройки:
Для host1:
server {
	listen	80;
	server_name	host1;

	location / {
		return 200 "This is HOST 1";
	}
}


Для host2:

server {
	listen	80;
	server_name	host2;

	location / {
		return 200 "This is HOST 2";
	}
}

Сохраняем, закрываем.

Проверка синтаксиса и рестарт nginx: 

ilnaz@ubuntu-linux:/etc/nginx/sites-enabled$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
ilnaz@ubuntu-linux:/etc/nginx/sites-enabled$ sudo systemctl restart nginx 

После рестарта проверка хостов с соответствующими хедерами:

ilnaz@ubuntu-linux:/etc/nginx/sites-enabled$ curl http://localhost -H 'Host: host2'
This is HOST 2ilnaz@ubuntu-linux:/etc/nginx/sites-enabled$ curl http://localhost -H 'Host: host1'
This is HOST 1ilnaz@ubuntu-linux:/etc/nginx/sites-enabled$


Получены необходимые по заданию сообщения.


